<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to counterfactuals • counterfactuals</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to counterfactuals">
<meta property="og:description" content="counterfactuals">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">counterfactuals</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to counterfactuals</a>
    </li>
    <li>
      <a href="../articles/how-to-add-new-cf-methods.html">How to extend the package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/TODO/issues/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to counterfactuals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TODO/issues/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>In the following, we explain the <code>counterfactuals</code> workflow for both a classification and a regression task using concrete use cases.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/TODO">counterfactuals</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://christophm.github.io/iml/">iml</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/">randomForest</a></span><span class="op">)</span></code></pre></div>
<div id="classification-tasks" class="section level2">
<h2 class="hasAnchor">
<a href="#classification-tasks" class="anchor"></a>Classification Tasks</h2>
<p>To illustrate the <code>counterfactuals</code> workflow for classification tasks, we search for counterfactuals for diabetes-tested patients with <code>MOC</code> (Dandl et al. 2020).</p>
<div id="data-pima-indians-diabetes-database" class="section level3">
<h3 class="hasAnchor">
<a href="#data-pima-indians-diabetes-database" class="anchor"></a>Data: Pima Indians Diabetes Database</h3>
<p>As training data, we use the Pima Indians Diabetes Database from the <code>mlbench</code> package. The data set contains 768 observations with 8 features and the binary target variable <code>diabetes</code>.</p>
<table class="table">
<thead><tr>
<th style="text-align:left;">
Variable
</th>
<th style="text-align:left;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
pregnant
</td>
<td style="text-align:left;">
Number of times pregnant
</td>
</tr>
<tr>
<td style="text-align:left;">
glucose
</td>
<td style="text-align:left;">
Plasma glucose concentration (glucose tolerance test)
</td>
</tr>
<tr>
<td style="text-align:left;">
pressure
</td>
<td style="text-align:left;">
Diastolic blood pressure (mm Hg)
</td>
</tr>
<tr>
<td style="text-align:left;">
triceps
</td>
<td style="text-align:left;">
Triceps skin fold thickness (mm)
</td>
</tr>
<tr>
<td style="text-align:left;">
insulin
</td>
<td style="text-align:left;">
2-Hour serum insulin (mu U/ml)
</td>
</tr>
<tr>
<td style="text-align:left;">
mass
</td>
<td style="text-align:left;">
Body mass index
</td>
</tr>
<tr>
<td style="text-align:left;">
pedigree
</td>
<td style="text-align:left;">
Diabetes pedigree function
</td>
</tr>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:left;">
Age (years)
</td>
</tr>
<tr>
<td style="text-align:left;">
diabetes
</td>
<td style="text-align:left;">
Class variable (test for diabetes)
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">PimaIndiansDiabetes</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span>  </code></pre></div>
<p>We convert <code>integerish</code> features to the <code>integer</code> data type to ensure that the counterfactuals will only contain <code>integer</code> values for these features (for example no <code>2.76</code> pregnancies).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PimaIndiansDiabetes</span><span class="op">$</span><span class="va">pregnant</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">PimaIndiansDiabetes</span><span class="op">$</span><span class="va">pregnant</span><span class="op">)</span>
<span class="va">PimaIndiansDiabetes</span><span class="op">$</span><span class="va">glucose</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">PimaIndiansDiabetes</span><span class="op">$</span><span class="va">glucose</span><span class="op">)</span>
<span class="va">PimaIndiansDiabetes</span><span class="op">$</span><span class="va">age</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">PimaIndiansDiabetes</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></code></pre></div>
</div>
<div id="fitting-a-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-a-model" class="anchor"></a>Fitting a model</h3>
<p>First, we train a model to predict <code>diabetes</code>, omitting one observation from the training data, which is <code>x_interest</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">20210816</span><span class="op">)</span>
<span class="va">rf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span><span class="va">diabetes</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">PimaIndiansDiabetes</span><span class="op">[</span><span class="op">-</span><span class="fl">499L</span>, <span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
<div id="setting-up-an-imlpredictor-object" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-an-imlpredictor-object" class="anchor"></a>Setting up an iml::Predictor() object</h3>
<p>An <a href="https://christophm.github.io/iml/reference/Predictor.html"><code>iml::Predictor</code></a> object serves as a wrapper for different model types. It contains the model and the data for its analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictor</span> <span class="op">=</span> <span class="va"><a href="https://christophm.github.io/iml/reference/Predictor.html">Predictor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">rf</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></code></pre></div>
</div>
<div id="find-counterfactuals" class="section level3">
<h3 class="hasAnchor">
<a href="#find-counterfactuals" class="anchor"></a>Find counterfactuals</h3>
<p>For <code>x_interest</code>, the model predicts a diabetes probability of 63.4%.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x_interest</span> <span class="op">=</span> <span class="va">PimaIndiansDiabetes</span><span class="op">[</span><span class="fl">499L</span>, <span class="op">]</span>
<span class="va">predictor</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">x_interest</span><span class="op">)</span>
<span class="co">#&gt;     neg   pos</span>
<span class="co">#&gt; 1 0.366 0.634</span></code></pre></div>
<p>Now, I examine which risk factors need to be changed to reduce the predicted diabetes probability to a maximum of 40%.<br>
Since we want to apply MOC to a classification model, we initialize a <code>MOCClassif</code> object. Individuals whose prediction is farther away from the desired prediction than <code>epsilon</code> can be penalized. Here, we set <code>epsilon = 0</code>, penalizing all individuals whose prediction is outside the desired interval. With the <code>fixed_features</code> argument, we can fix non-actionable features to their current value.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">moc_classif</span> <span class="op">=</span> <span class="va"><a href="../reference/MOCClassif.html">MOCClassif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  <span class="va">predictor</span>, epsilon <span class="op">=</span> <span class="fl">0</span>, fixed_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pregnant"</span>, <span class="st">"age"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Then, we use the <code>find_counterfactuals()</code> method to find counterfactuals for <code>x_interest</code>. As we aim to find counterfactuals with a predicted diabetes probability of at most 40%, we set the <code>desired_class</code> to <code>"pos"</code> and the <code>desired_prob</code> to <code>c(0, 0.4)</code>; in the binary classification case, this is equivalent to setting <code>desired_class</code> to <code>"neg"</code> and <code>desired_prob</code> to <code>c(0.6, 1)</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfactuals</span> <span class="op">=</span> <span class="va">moc_classif</span><span class="op">$</span><span class="fu">find_counterfactuals</span><span class="op">(</span>
  <span class="va">x_interest</span>, desired_class <span class="op">=</span> <span class="st">"pos"</span>, desired_prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.4</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="the-counterfactuals-object" class="section level3">
<h3 class="hasAnchor">
<a href="#the-counterfactuals-object" class="anchor"></a>The counterfactuals object</h3>
<p>The resulting <code>Counterfactuals</code> object holds the counterfactuals in the <code>data</code> field and possesses several methods for their evaluation and visualization.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">cfactuals</span><span class="op">)</span>
<span class="co">#&gt; [1] "Counterfactuals" "R6"</span></code></pre></div>
<p>Printing a <code>Counterfactuals</code> object, gives an overview of the results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cfactuals</span><span class="op">)</span>
<span class="co">#&gt; 289 Counterfactual(s) </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Desired class: pos </span>
<span class="co">#&gt; Desired predicted probability range: [0, 0.4] </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Head: </span>
<span class="co">#&gt;    pregnant glucose pressure triceps insulin mass  pedigree age</span>
<span class="co">#&gt; 1:        7     148       70      33     145 25.1 0.1630000  55</span>
<span class="co">#&gt; 2:        7     142       70      33     145 25.1 0.1630000  55</span>
<span class="co">#&gt; 3:        7     130       70      33     145 25.1 0.6711319  55</span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> method returns the predictions for the counterfactuals.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">cfactuals</span><span class="op">$</span><span class="va">data</span>, <span class="va">cfactuals</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fl">5L</span><span class="op">)</span>
<span class="co">#&gt;    pregnant glucose pressure triceps insulin mass  pedigree age   neg   pos</span>
<span class="co">#&gt; 1:        7     148       70      33     145 25.1 0.1630000  55 0.618 0.382</span>
<span class="co">#&gt; 2:        7     142       70      33     145 25.1 0.1630000  55 0.700 0.300</span>
<span class="co">#&gt; 3:        7     130       70      33     145 25.1 0.6711319  55 0.700 0.300</span>
<span class="co">#&gt; 4:        7     137       70      33     145 25.1 0.1630000  55 0.726 0.274</span>
<span class="co">#&gt; 5:        7     141       70      33     145 25.1 0.1630000  55 0.714 0.286</span></code></pre></div>
<p>The <code>evaluate()</code> method returns the counterfactuals along with the evaluation measures <code>dist_x_interest</code>, <code>dist_target</code>, <code>nr_changed</code>, and <code>dist_train</code>.<br>
Setting the <code>show_diff</code> argument to <code>TRUE</code> displays the counterfactuals as their difference to <code>x_interest</code>: for a numeric feature, positive values indicate an increase compared to the feature value in <code>x_interest</code> and negative values indicate a decrease; for factors, the counterfactual feature value is displayed if it differs from <code>x_interest.</code>; <code>NA</code> means “no difference” in both cases.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cfactuals</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span>show_diff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">5L</span><span class="op">)</span>
<span class="co">#&gt;    pregnant glucose pressure triceps insulin mass  pedigree age dist_x_interest nr_changed dist_train dist_target</span>
<span class="co">#&gt; 1:       NA     -47       NA      NA      NA   NA        NA  NA      0.02952261          1 0.05779453           0</span>
<span class="co">#&gt; 2:       NA     -53       NA      NA      NA   NA        NA  NA      0.03329146          1 0.05402569           0</span>
<span class="co">#&gt; 3:       NA     -65       NA      NA      NA   NA 0.5081319  NA      0.06794976          2 0.02948106           0</span>
<span class="co">#&gt; 4:       NA     -58       NA      NA      NA   NA        NA  NA      0.03643216          1 0.05088498           0</span>
<span class="co">#&gt; 5:       NA     -54       NA      NA      NA   NA        NA  NA      0.03391960          1 0.05339755           0</span></code></pre></div>
<p>The <code>plot_freq_of_feature_changes()</code> method plots the frequency of feature changes across all counterfactuals.<br>
Setting <code>subset_zero = TRUE</code> removes all unchanged features from the plot.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfactuals</span><span class="op">$</span><span class="fu">plot_freq_of_feature_changes</span><span class="op">(</span>subset_zero <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>The parallel plot connects the (scaled) feature values of each counterfactual and highlights <code>x_interest</code> in blue.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfactuals</span><span class="op">$</span><span class="fu">plot_parallel</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<p>The white dot in the prediction surface plot represents <code>x_interest</code>. All counterfactuals that differ from <code>x_interest</code> only in the selected features are displayed as black dots. The tick marks next to the axes indicate the marginal distribution of the counterfactuals.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfactuals</span><span class="op">$</span><span class="fu">plot_surface</span><span class="op">(</span>feature_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mass"</span>, <span class="st">"glucose"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
</div>
<div id="moc-diagnostics" class="section level3">
<h3 class="hasAnchor">
<a href="#moc-diagnostics" class="anchor"></a>MOC diagnostics</h3>
<p>To evaluate the estimated Pareto front, Dandl et al. (2020) use a hypervolume indicator (Zitzler and Thiele 1998) with a reference point that represents the maximal values of the objectives. The evolution of the hypervolume indicator can be plotted together with the evolution of mean and minimum objective values using the <code>plot_statistics()</code> method.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">moc_classif</span><span class="op">$</span><span class="fu">plot_statistics</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="introduction-res/moc_stats_plots.png" width="97%"></p>
<p>Ideally, one would like the mean value of each objective to decrease over the generations, leading to an increase of the hypervolume. However, there is often a trade-off between the objectives. Here, the mean values of <code>dist_target</code> and <code>dist_train</code> remain relatively constant over the generations, indicating that it is difficult to minimize both objectives simultaneously.</p>
<p>This trade-off can also be seen in the scatter plot—created by the <code>plot_search()</code> method—that visualizes two selected objective values of all individuals. Ideally, one would like to have a point shift to the lower left corner over the generations, which implies better objective values. Here, the points for the objectives <code>dist_train</code> and <code>dist_target</code> are shifted to a middle region, which underlines the difficulty of minimizing both objectives simultaneously.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">moc_classif</span><span class="op">$</span><span class="fu">plot_search</span><span class="op">(</span>objectives <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dist_train"</span>, <span class="st">"dist_target"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>The exact interdependence between the objectives depends on the task at hand.</p>
</div>
</div>
<div id="regression-tasks" class="section level2">
<h2 class="hasAnchor">
<a href="#regression-tasks" class="anchor"></a>Regression Tasks</h2>
<p>Finding counterfactuals for regression models is analogous to classification models. In this example, we use <code>WhatIf</code> (Wexler et al. 2019) to search for counterfactuals for housing prices.</p>
<div id="data-boston-housing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#data-boston-housing-data" class="anchor"></a>Data: Boston Housing Data</h3>
<p>As training data, we use the Boston Housing dataset from the <code>mlbench</code> package. The dataset contains 506 observations with 13 features and the (continuous) target variable <code>medv</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">BostonHousing</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span>  </code></pre></div>
</div>
<div id="fitting-a-model-1" class="section level3">
<h3 class="hasAnchor">
<a href="#fitting-a-model-1" class="anchor"></a>Fitting a model</h3>
<p>First, we train a model to predict <code>medv</code>, again omitting <code>x_interest</code> from the training data.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">20210713</span><span class="op">)</span>
<span class="va">rf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">BostonHousing</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span>, <span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
<div id="setting-up-an-imlpredictor-object-1" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-an-imlpredictor-object-1" class="anchor"></a>Setting up an iml::Predictor() object</h3>
<p>Then, we initialize an <a href="https://christophm.github.io/iml/reference/Predictor.html"><code>iml::Predictor</code></a> object.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictor</span> <span class="op">=</span> <span class="va"><a href="https://christophm.github.io/iml/reference/Predictor.html">Predictor</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">rf</span><span class="op">)</span></code></pre></div>
</div>
<div id="find-counterfactuals-1" class="section level3">
<h3 class="hasAnchor">
<a href="#find-counterfactuals-1" class="anchor"></a>Find counterfactuals</h3>
<p>For <code>x_interest</code>, the model predicts a median housing value of 28.32.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x_interest</span> <span class="op">=</span> <span class="va">BostonHousing</span><span class="op">[</span><span class="fl">1L</span>, <span class="op">]</span>
<span class="va">predictor</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">x_interest</span><span class="op">)</span>
<span class="co">#&gt;       pred</span>
<span class="co">#&gt; 1 28.32244</span></code></pre></div>
<p>Since we want to apply <code>WhatIf</code> to a regression model, we initialize a <code>WhatIfRegr</code> object. The argument <code>n_counterfactuals</code> specifies the number of counterfactuals to return.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">whatif_regr</span> <span class="op">=</span> <span class="va"><a href="../reference/WhatIfRegr.html">WhatIfRegr</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">predictor</span>, n_counterfactuals <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></code></pre></div>
<p>Then, we use the <code>find_counterfactuals()</code> method to find counterfactuals for <code>x_interest</code> with a predicted housing value in the interval [30, 32].</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfactuals</span> <span class="op">=</span> <span class="va">whatif_regr</span><span class="op">$</span><span class="fu">find_counterfactuals</span><span class="op">(</span><span class="va">x_interest</span>, desired_outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">32</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="the-counterfactuals-object-1" class="section level3">
<h3 class="hasAnchor">
<a href="#the-counterfactuals-object-1" class="anchor"></a>The counterfactuals object</h3>
<p>As a result, we obtain a <code>Counterfactuals</code> object, just like for the classification task.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cfactuals</span>
<span class="co">#&gt; 5 Counterfactual(s) </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Desired outcome range: [30, 32] </span>
<span class="co">#&gt;  </span>
<span class="co">#&gt; Head: </span>
<span class="co">#&gt;       crim zn indus chas   nox    rm  age    dis rad tax ptratio      b lstat</span>
<span class="co">#&gt; 1: 0.10008  0  2.46    0 0.488 6.563 95.6 2.8470   3 193    17.8 396.90  5.68</span>
<span class="co">#&gt; 2: 0.02187 60  2.93    0 0.401 6.800  9.9 6.2196   1 265    15.6 393.37  5.03</span>
<span class="co">#&gt; 3: 0.06888  0  2.46    0 0.488 6.144 62.2 2.5979   3 193    17.8 396.90  9.45</span></code></pre></div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Dandl, Susanne, Christoph Molnar, Martin Binder, and Bernd Bischl. 2020. “MultiObjective Counterfactual Explanations.” In Parallel Problem Solving from Nature – PPSN XVI, edited by Thomas Bäck, Mike Preuss, André Deutz, Hao Wang, Carola Doerr, Michael Emmerich, and Heike Trautmann, 448–69. Cham: Springer International Publishing.</p>
<p>Wexler, James, Mahima Pushkarna, Tolga Bolukbasi, Martin Wattenberg, Fernanda Viégas, and Jimbo Wilson. 2019. “The What-If Tool: Interactive Probing of Machine Learning Models.” IEEE Transactions on Visualization and Computer Graphics 26 (1): 56–65.</p>
<p>Zitzler, Eckart, and Lothar Thiele. 1998. “Multiobjective Optimization Using Evolutionary Algorithms—a Comparative Case Study.” In International Conference on Parallel Problem Solving from Nature, 292–301. Springer.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Susanne Dandl, Andreas Hofheinz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
