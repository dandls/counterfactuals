<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Counterfactuals Class — Counterfactuals • counterfactuals</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Counterfactuals Class — Counterfactuals"><meta property="og:description" content="A Counterfactuals object should be created by the $find_counterfactuals method of CounterfactualMethodRegr
or CounterfactualMethodClassif.
It contains the counterfactuals and has several methods for their evaluation and visualization."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">counterfactuals</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/introduction.html">Introduction to counterfactuals</a>
    </li>
    <li>
      <a href="../articles/how-to-add-new-cf-methods.html">How to extend the package</a>
    </li>
    <li>
      <a href="../articles/customized-distance-functions.html">Customized distance functions</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dandls/counterfactuals/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Counterfactuals Class</h1>
    <small class="dont-index">Source: <a href="https://github.com/dandls/counterfactuals/blob/HEAD/R/Counterfactuals.R" class="external-link"><code>R/Counterfactuals.R</code></a></small>
    <div class="hidden name"><code>Counterfactuals.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A <code>Counterfactuals</code> object should be created by the <code>$find_counterfactuals</code> method of <a href="CounterfactualMethodRegr.html">CounterfactualMethodRegr</a>
or <a href="CounterfactualMethodClassif.html">CounterfactualMethodClassif</a>.
It contains the counterfactuals and has several methods for their evaluation and visualization.</p>
    </div>


    <div id="references">
    <h2>References</h2>
    <p>Gower, J. C. (1971), "A general coefficient of similarity and some of its properties". Biometrics, 27, 623–637.</p>
    </div>
    <div id="active-bindings">
    <h2>Active bindings</h2>
    <p></p><div class="r6-active-bindings"><dl><dt><code>desired</code></dt>
<dd><p>(<code>list(1)</code> | <code>list(2)</code>)<br>
A <code>list</code> with the desired properties of the counterfactuals.
For regression tasks it has one element <code>desired_outcome</code> (<a href="CounterfactualMethodRegr.html">CounterfactualMethodRegr</a>) and for
classification tasks two elements <code>desired_class</code> and <code>desired_prob</code> (<a href="CounterfactualMethodClassif.html">CounterfactualMethodClassif</a>).</p></dd>


<dt><code>data</code></dt>
<dd><p>(<code>data.table</code>)<br>
The counterfactuals for <code>x_interest</code>.</p></dd>


<dt><code>x_interest</code></dt>
<dd><p>(<code>data.table(1)</code>) <br>
A single row with the observation of interest.</p></dd>


<dt><code>distance_function</code></dt>
<dd><p>(<code>function()</code>) <br>
The distance function used in the second and fourth evaluation measure.
The function must have three arguments:
<code>x</code>, <code>y</code>, and <code>data</code> and return a <code>numeric</code> matrix. If set to <code>NULL</code> (default), then Gower distance (Gower 1971) is used.</p></dd>


</dl><p></p></div>
    </div>
    <div id="methods">
    <h2>Methods</h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-new"><code>Counterfactuals$new()</code></a></p></li>
<li><p><a href="#method-evaluate"><code>Counterfactuals$evaluate()</code></a></p></li>
<li><p><a href="#method-predict"><code>Counterfactuals$predict()</code></a></p></li>
<li><p><a href="#method-plot_parallel"><code>Counterfactuals$plot_parallel()</code></a></p></li>
<li><p><a href="#method-plot_freq_of_feature_changes"><code>Counterfactuals$plot_freq_of_feature_changes()</code></a></p></li>
<li><p><a href="#method-get_freq_of_feature_changes"><code>Counterfactuals$get_freq_of_feature_changes()</code></a></p></li>
<li><p><a href="#method-plot_surface"><code>Counterfactuals$plot_surface()</code></a></p></li>
<li><p><a href="#method-print"><code>Counterfactuals$print()</code></a></p></li>
<li><p><a href="#method-clone"><code>Counterfactuals$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Creates a new <code>Counterfactuals</code> object.
This method should only be called by the <code>$find_counterfactuals</code> methods of <a href="CounterfactualMethodRegr.html">CounterfactualMethodRegr</a>
and <a href="CounterfactualMethodClassif.html">CounterfactualMethodClassif</a>.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va"><a href="../reference/Counterfactuals.html">Counterfactuals</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">cfactuals</span>, <span class="va">predictor</span>, <span class="va">x_interest</span>, <span class="va">param_set</span>, <span class="va">desired</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>cfactuals</code></dt>
<dd><p>(<code>data.table</code>) <br>
The counterfactuals. Must have the same column names and types as <code>predictor$data$X</code>.</p></dd>


<dt><code>predictor</code></dt>
<dd><p>(<a href="https://christophm.github.io/iml/reference/Predictor.html" class="external-link">Predictor</a>)<br>
The object (created with <code>iml::Predictor$new()</code>) holding the machine learning model and the data.</p></dd>


<dt><code>x_interest</code></dt>
<dd><p>(<code>data.table(1)</code> | <code>data.frame(1)</code>) <br>
A single row with the observation of interest.</p></dd>


<dt><code>param_set</code></dt>
<dd><p>(<a href="https://paradox.mlr-org.com/reference/ParamSet.html" class="external-link">ParamSet</a>)<br>
A <a href="https://paradox.mlr-org.com/reference/ParamSet.html" class="external-link">ParamSet</a> based on the features of <code>predictor$data$X</code>.</p></dd>


<dt><code>desired</code></dt>
<dd><p>(<code>list(1)</code> | <code>list(2)</code>)<br>
A <code>list</code> with the desired properties of the counterfactuals. It should have one element <code>desired_outcome</code> for
regression tasks (<a href="CounterfactualMethodRegr.html">CounterfactualMethodRegr</a>) and two elements <code>desired_class</code> and <code>desired_prob</code>
for classification tasks (<a href="CounterfactualMethodClassif.html">CounterfactualMethodClassif</a>).</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-evaluate"></a><div class="section">
<h3 id="method-evaluate-">Method <code>evaluate()</code><a class="anchor" aria-label="anchor" href="#method-evaluate-"></a></h3>
<p>Evaluates the counterfactuals. It returns the counterfactuals together with the evaluation <code>measures</code>.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">evaluate</span><span class="op">(</span>
  measures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dist_x_interest"</span>, <span class="st">"dist_target"</span>, <span class="st">"no_changed"</span>, <span class="st">"dist_train"</span><span class="op">)</span>,
  show_diff <span class="op">=</span> <span class="cn">FALSE</span>,
  k <span class="op">=</span> <span class="fl">1L</span>,
  weights <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>measures</code></dt>
<dd><p>(<code>character</code>) <br>
The name of one or more evaluation measures.
The following measures are available:</p><ul><li><p><code>dist_x_interest</code>: The distance of a counterfactual to <code>x_interest</code> measured by Gower's
dissimilarity measure (Gower 1971).</p></li>
<li><p><code>dist_target</code>: The absolute distance of the prediction for a counterfactual to the interval <code>desired_outcome</code>
(regression tasks) or <code>desired_prob</code> (classification tasks).</p></li>
<li><p><code>no_changed</code>: The number of feature changes w.r.t. <code>x_interest</code>.</p></li>
<li><p><code>dist_train</code>: The (weighted) distance to the <code>k</code> nearest training data points measured by Gower's
dissimilarity measure (Gower 1971).</p></li>
</ul></dd>


<dt><code>show_diff</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
Should the counterfactuals be displayed as their differences to <code>x_interest</code>? Default is <code>FALSE</code>.
If set to <code>TRUE</code>, positive values for numeric features indicate an increase compared to the feature value in
<code>x_interest</code>, negative values indicate a decrease. For factors, the feature value is displayed if it differs
from <code>x_interest</code>; <code>NA</code> means "no difference" in both cases.</p></dd>


<dt><code>k</code></dt>
<dd><p>(<code>integerish(1)</code>) <br>
How many nearest training points should be considered for computing the <code>dist_train</code> measure? Default is <code>1L</code>.</p></dd>


<dt><code>weights</code></dt>
<dd><p>(<code>numeric(k)</code> | <code>NULL</code>) <br>
How should the <code>k</code> nearest training points be weighted when computing the <code>dist_train</code> measure? If <code>NULL</code>
(default) then all <code>k</code> points are weighted equally. If a numeric vector of length <code>k</code> is given, the i-th element
specifies the weight of the i-th closest data point.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-predict"></a><div class="section">
<h3 id="method-predict-">Method <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code><a class="anchor" aria-label="anchor" href="#method-predict-"></a></h3>
<p>Returns the predictions for the counterfactuals.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-plot_parallel"></a><div class="section">
<h3 id="method-plot-parallel-">Method <code>plot_parallel()</code><a class="anchor" aria-label="anchor" href="#method-plot-parallel-"></a></h3>
<p>Plots a parallel plot that connects the (scaled) numeric feature values of each counterfactual and highlights
<code>x_interest</code> in blue.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">plot_parallel</span><span class="op">(</span>
  feature_names <span class="op">=</span> <span class="cn">NULL</span>,
  row_ids <span class="op">=</span> <span class="cn">NULL</span>,
  digits_min_max <span class="op">=</span> <span class="fl">2L</span>
<span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>feature_names</code></dt>
<dd><p>(<code>character</code> | <code>NULL</code>)<br>
The names of the (numeric) features to display. If <code>NULL</code> (default) all features are displayed.</p></dd>


<dt><code>row_ids</code></dt>
<dd><p>(<code>integerish</code> | <code>NULL</code>)<br>
The row ids of the counterfactuals to display. If <code>NULL</code> (default) all counterfactuals are displayed.</p></dd>


<dt><code>digits_min_max</code></dt>
<dd><p>Maximum number of digits for the minimum and maximum features values. Default is <code>2L</code>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-plot_freq_of_feature_changes"></a><div class="section">
<h3 id="method-plot-freq-of-feature-changes-">Method <code>plot_freq_of_feature_changes()</code><a class="anchor" aria-label="anchor" href="#method-plot-freq-of-feature-changes-"></a></h3>
<p>Plots a bar chart with the frequency of feature changes across all counterfactuals.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">plot_freq_of_feature_changes</span><span class="op">(</span>subset_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>subset_zero</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
Should unchanged features be excluded from the plot? Default is <code>FALSE</code>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-get_freq_of_feature_changes"></a><div class="section">
<h3 id="method-get-freq-of-feature-changes-">Method <code>get_freq_of_feature_changes()</code><a class="anchor" aria-label="anchor" href="#method-get-freq-of-feature-changes-"></a></h3>
<p>Returns the frequency of feature changes across all counterfactuals.</p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">get_freq_of_feature_changes</span><span class="op">(</span>subset_zero <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>subset_zero</code></dt>
<dd><p>(<code>logical(1)</code>)<br>
Should unchanged features be excluded? Default is <code>FALSE</code>.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A (named) <code>numeric</code> vector with the frequency of feature changes.</p>
</div>

</div><p></p><hr><a id="method-plot_surface"></a><div class="section">
<h3 id="method-plot-surface-">Method <code>plot_surface()</code><a class="anchor" aria-label="anchor" href="#method-plot-surface-"></a></h3>
<p>Creates a surface plot for two features. <code>x_interest</code> is represented as a white dot and
all counterfactuals that differ from <code>x_interest</code> <strong>only</strong> in the two selected features are represented as black dots.
The tick marks next to the axes show the marginal distribution of the observed data (<code>predictor$data$X</code>). <br>
The exact plot type depends on the selected feature types and number of features:</p><ul><li><p>2 numeric features: surface plot</p></li>
<li><p>2 non-numeric features: heatmap</p></li>
<li><p>1 numeric or non-numeric feature: line graph</p></li>
</ul><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">plot_surface</span><span class="op">(</span><span class="va">feature_names</span>, grid_size <span class="op">=</span> <span class="fl">250L</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>feature_names</code></dt>
<dd><p>(<code>character(2)</code>)<br>
The names of the features to plot.</p></dd>


<dt><code>grid_size</code></dt>
<dd><p>(<code>integerish(1)</code>)<br>
The grid size of the plot. It is ignored in case of two <code>non-numeric</code> features. Default is <code>250L</code>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-print"></a><div class="section">
<h3 id="method-print-">Method <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code><a class="anchor" aria-label="anchor" href="#method-print-"></a></h3>
<p>Prints the <code>Counterfactuals</code> object.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span class="va">Counterfactuals</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Susanne Dandl, Andreas Hofheinz, Martin Binder, Giuseppe Casalicchio.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

